{% extends "base.html" %}

{% block title %}
Panel de Medición de Ruido
{% endblock %}

{% block extra_css %}
<style>
  .panel {
    background: #ffffff;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.06);
  }

  .metric-card {
    background: #ffffff;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    padding: 22px;
    height: 100%;
    transition: all 0.2s ease;
  }

  .metric-card:hover {
    transform: translateY(-2px);
  }

  .metric-title {
    font-size: 0.9rem;
    color: #64748b;
  }

  .metric-value {
    font-size: 1.8rem;
    font-weight: 600;
  }

  .estado-normal { color: #16a34a; }
  .estado-medio { color: #f59e0b; }
  .estado-alto { color: #dc2626; }
</style>
{% endblock %}

{% block content %}

<div class="mb-4">
  <h3 class="fw-bold">Dispositivo {{ dispositivo_id|default:"1" }}</h3>
  <p class="text-muted mb-0">Historial de niveles sonoros registrados</p>
</div>

<div class="row g-4 mb-4">

  <div class="col-md-4">
    <div class="metric-card">
      <div class="metric-title">Último nivel registrado</div>
      <div class="metric-value estado-normal">52 dB</div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="metric-card">
      <div class="metric-title">Estado presencia</div>
      <div class="metric-value">Presente</div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="metric-card">
      <div class="metric-title">Última actualización</div>
      <div class="metric-value fs-6">24/11/2025 16:25</div>
    </div>
  </div>

</div>

<div class="panel">

  <h5 class="fw-bold mb-3">Registro de lecturas</h5>

  <table class="table table-bordered align-middle">
    <thead class="table-light">
      <tr>
        <th>Fecha y hora</th>
        <th class="text-center">Nivel (dB)</th>
        <th class="text-center">Presencia</th>
      </tr>
    </thead>
    <tbody>

    {% if lecturas %}
      {% for lectura in lecturas %}
      <tr>
        <td>{{ lectura.fecha_hora|date:"d/m/Y H:i:s" }}</td>

        <td class="text-center fw-semibold">
          {% if lectura.nivel_db < 60 %}
            <span class="estado-normal">{{ lectura.nivel_db }} dB</span>
          {% elif lectura.nivel_db < 80 %}
            <span class="estado-medio">{{ lectura.nivel_db }} dB</span>
          {% else %}
            <span class="estado-alto">{{ lectura.nivel_db }} dB</span>
          {% endif %}
        </td>

        <td class="text-center">
          {% if lectura.presencia %}
            <span class="text-success">Presente</span>
          {% else %}
            <span class="text-secondary">Sin presencia</span>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    {% endif %}

    </tbody>
  </table>

</div>

{% endblock %}
